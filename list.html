<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="styles.css">
	<title>PMD Portrait Repository</title>
	<script
		src="https://code.jquery.com/jquery-3.3.1.js"
		integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
		crossorigin="anonymous">
	</script>
	<script>
		$(function(){
			$("#header").load("header.html"); 
			$("#footer").load("footer.html"); 
		});
		
		function findGetParameter(parameterName) {
			let result = null, tmp = [];
			location.search.substr(1).split("&").forEach(function (item) {
				tmp = item.split("=");
				if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
			});
			return result;
		}
		
		async function populateTable(gen, notofficial, filled){
		
			let gens = [["0001","0898"],
						["0001","0151"],
						["0152","0251"],
						["0252","0386"],
						["0387","0493"],
						["0494","0649"],
						["0650","0721"],
						["0722","0809"],
						["0810","0898"]]
						
			let min = gens[gen][0];
			let max = gens[gen][1];
		
			let tracker = await fetch('tracker.json').then(response => response.json());
			
			let table = document.getElementById("main");

			for (const entry in tracker){
			
				if (entry < min || entry > max) continue;
				if (!(tracker[entry]["portrait_credit"])) continue;
				if (notofficial && tracker[entry]["portrait_credit"] == "CHUNSOFT") continue;
				if (filled && tracker[entry]["portrait_complete"] != 2) continue;
			
				let row = table.insertRow();
				
				let pkdex = row.insertCell(0);
				pkdex.innerHTML = entry;
				
				let portrait = row.insertCell(1);
				portrait.innerHTML = "<img src=\"portrait/"+entry+"/Normal.png\"></img>"
				
				let name = row.insertCell(2);
				name.innerHTML = tracker[entry]["name"];
				
				let status = row.insertCell(3);
				stn = tracker[entry]["portrait_complete"]
				if (stn == 0 || stn == 1){st = "Exists"}else{st = "Fully Featured"}
				status.innerHTML = st;
				status.attributes = "class=\"status-"+stn+"\""
				
				let link = row.insertCell(4);
				link.innerHTML = "<a href=\"portrait.html?id="+entry+"\">Portrait</a>";
				
			}
			
		}
		
		let gen = findGetParameter("gen");
		if (gen < 0 || gen > 8) gen = 3
		if (!(gen)) gen = 0;
		let notofficial = findGetParameter("notofficial");
		let filled = findGetParameter("filled");
		
		populateTable(gen,notofficial,filled);
		
	</script>
</head>
<body>
	<div id="header"></div>
	
	<table class="list-table">
		<thead>
			<tr>
				<th>Pkdex #</th>
				<th></th>
				<th>Name</th>
				<th>Status</th>
				<th>Portrait</th>
			</tr>
		</thead>
		<tbody id="main"></tbody>
	</table>
	
	<div id="footer"></div>
</body>
</html>
